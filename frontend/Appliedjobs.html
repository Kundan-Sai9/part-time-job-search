<!DOCTYPE html>
<html lang="en">
<head>
    <title>Applied Jobs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: black;
            margin: 0;
            padding: 0;
            color: white;
        }
        header {
            background: #ff5722;
            width:100%;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0px 4px 10px rgba(255, 87, 34, 0.5);
        }
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 0 20px;
        }
        .logo-img {
            width: 100px;
            height: auto;
        }
        nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2rem;
            transition: color 0.3s;
        }
        nav ul li a:hover {
            color: black;
        }
        .content {
            text-align: center;
            padding: 50px 20px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 50px;
            max-width: 1200px;
            margin: auto;
        }
        .card {
            background: #222;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            text-align: center;
            box-shadow: 0px 4px 10px rgba(255, 87, 34, 0.5);
        }
        .card .title {
            font-size: 1.5rem;
            color: #ff5722;
        }
        .applied-jobs-section {
            text-align: left;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 8px;
        }
        .applied-jobs-section h2 {
            color: gold;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .applied-jobs-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .applied-jobs-section li {
            padding: 10px;
            margin-bottom: 10px;
            background: #222;
            border: 1px solid gold;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
        }
    </style>
</head>
<body>

    <header>
        <div class="nav-container">
            <img src="part-time.png" alt="logo" class="logo-img">
            <nav>
                <ul>
                    <li><a href="home.html">Home</a></li>
                    <li><a href="jobpost.html">Post Job</a></li>
                    <li><a href="account.html">Edit</a></li>
                    <li><a href="Appliedjobs.html">Applied Jobs</a></li>
                    <li id="auth-menu">
                        <a href="login.html" id="auth-link">Login</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="content">
            <h1>Your Applied Jobs</h1>
            <p>View the jobs you have applied for.</p>
        </section>

        <section class="applied-jobs-section">
            <h2>Applied Jobs</h2>
            <ul id="appliedJobsList"></ul>
        </section>
    </main>

    <script>
        let currentUser = null;

        function checkLoginStatus() {
            fetch("AuthServlet?action=getUserInfo", {
                method: "GET",
                credentials: "include"
            })
            .then(response => response.json())
            .then(data => {
                let authMenu = document.getElementById("auth-menu");
                if (data.user_id) {
                    currentUser = data.user_id;
                    authMenu.innerHTML = `<a href="#" onclick="logout()">Logout</a>`;
                    fetchAppliedJobs(); // Ensure applied jobs load after login
                }
            })
            .catch(error => console.error("Error checking login status:", error));
        }


        function fetchAppliedJobs() {
            if (!currentUser) {
                console.log("No user is logged in.");
                return;
            }

            console.log("Fetching applied jobs for user:", currentUser);

            fetch("AuthServlet", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `action=getAppliedJobs&user_id=${currentUser}`,
                credentials: "include"
            })
            .then(response => response.json())
            .then(data => {
                console.log("Applied Jobs Data:", data); // Debug log

                let jobList = document.getElementById("appliedJobsList");
                jobList.innerHTML = "";

                if (data.jobs && data.jobs.length > 0) {
                    data.jobs.forEach(job => {
                        let li = document.createElement("li");
                        li.innerText = `${job.title} at ${job.company}`;
                        jobList.appendChild(li);
                    });
                } else {
                    let li = document.createElement("li");
                    li.innerText = "No jobs applied yet.";
                    jobList.appendChild(li);
                }
            })
            .catch(error => {
                console.error("Error fetching applied jobs:", error);
                alert("Error fetching applied jobs. Check console for details.");
            });
        }

        function logout() {
            fetch("AuthServlet?action=logout", {
                method: "POST",
                credentials: "include"
            })
            .then(() => {
                sessionStorage.clear();
                window.location.href = "home.html";
            });
        }

        checkLoginStatus();
    </script>

</body>
</html>
